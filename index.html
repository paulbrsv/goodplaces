<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ĞšĞ°Ñ€Ñ‚Ğ° ĞºĞ¾Ñ„ĞµĞµĞ½</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body>

<header>
    <h1>GOOD PLACES</h1>
    <div class="filters">
        <span class="filter" data-filter="no_smoking">ğŸš­ No smoking</span>
        <span class="filter" data-filter="pets_allowed">ğŸ¾ Pet friendly</span>
        <span class="filter-divider">|</span>
        <span class="filter" data-filter="specialty">â˜• Ğ¡Ğ¿ĞµÑˆĞµĞ»Ñ‚Ğ¸ ĞºĞ¾Ñ„Ğµ</span>
        <span class="filter" data-filter="desserts">ğŸ° Ğ”ĞµÑĞµÑ€Ñ‚Ñ‹</span>
        <span class="filter" data-filter="bar">ğŸ¸ Ğ‘Ğ°Ñ€</span>
        <span class="filter" data-filter="beer">ğŸ» ĞŸĞ¸Ğ²Ğ¾</span>
        <span class="filter" data-filter="wine">ğŸ· Ğ’Ğ¸Ğ½Ğ¾</span>
        <span class="filter-reset">ğŸ”„ Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ</span>
    </div>
</header>

<div id="sidebar">

    <div class="place-list">
        <h3>ğŸ“ Ğ’ ÑÑ‚Ğ¾Ğ¼ Ñ€Ğ°Ğ¹Ğ¾Ğ½Ğµ</h3>
        <div id="visible-places"></div>
    </div>
    <div class="place-list">
        <h3>ğŸ“ Ğ•Ñ‰Ñ‘ Ñ€ÑĞ´Ğ¾Ğ¼</h3>
        <div id="outside-places"></div>
    </div>
</div>

<div id="map"></div>

<script>
    var map = L.map('map').setView([45.25, 19.85], 14);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap contributors & Carto'
    }).addTo(map);

    var markers = [];
    var placesData = [];
    let activeFilters = [];

    const attributeNames = {
        "specialty": "â˜• Ğ¡Ğ¿ĞµÑˆĞµĞ»Ñ‚Ğ¸ ĞºĞ¾Ñ„Ğµ",
        "desserts": "ğŸ° Ğ”ĞµÑĞµÑ€Ñ‚Ñ‹",
        "no_smoking": "ğŸš­ ĞĞµ ĞºÑƒÑ€ÑÑ‚",
        "pets_allowed": "ğŸ¾ ĞœĞ¾Ğ¶Ğ½Ğ¾ Ñ Ğ¶Ğ¸Ğ²Ğ¾Ñ‚Ğ½Ñ‹Ğ¼Ğ¸"
    };

    document.querySelectorAll('.filter').forEach(filter => {
        filter.addEventListener('click', () => {
            const filterId = filter.dataset.filter;
            if (activeFilters.includes(filterId)) {
                activeFilters = activeFilters.filter(f => f !== filterId);
                filter.classList.remove('active');
            } else {
                activeFilters.push(filterId);
                filter.classList.add('active');
            }
            updateMap();
        });
    });

    document.querySelector('.filter-reset').addEventListener('click', () => {
        activeFilters = [];
        document.querySelectorAll('.filter').forEach(filter => filter.classList.remove('active'));
        updateMap();
    });

    function updateMap() {
        const filteredPlaces = placesData.filter(place => {
            if (activeFilters.length === 0) return true;
            return activeFilters.every(filter => place.attributes.includes(filter));
        });

        markers.forEach(marker => marker.remove());
        markers = [];

        filteredPlaces.forEach(place => {
            const popupContent = `
                <div class="popup-content">
                    <img src="${place.image}" alt="${place.name}">
                    <div class="popup-text">
                        <h3>${place.name}</h3>
                        <p>${place.description}</p>
                        <div class="popup-attributes">${place.attributes.map(attr => attributeNames[attr] || attr).join(' | ')}</div>
                        <div class="popup-links">
                            <a href="${place.link}" target="_blank">ğŸŒ Ğ¡Ğ°Ğ¹Ñ‚</a>
                            <a href="${place.instagram}" target="_blank">ğŸ“¸ Instagram</a>
                            <a href="https://www.google.com/maps/search/?api=1&query=${place.lat},${place.lng}" target="_blank">ğŸ“ ĞšĞ°Ñ€Ñ‚Ğ°</a>
                        </div>
                    </div>
                </div>`;
            const marker = L.marker([place.lat, place.lng]).addTo(map).bindPopup(popupContent);
            marker.placeName = place.name;
            markers.push(marker);
        });
        updateSidebar(filteredPlaces);
    }

    function updateSidebar(filteredPlaces) {
        const visibleList = document.getElementById("visible-places");
        const outsideList = document.getElementById("outside-places");
        visibleList.innerHTML = "";
        outsideList.innerHTML = "";

        const bounds = map.getBounds();
        filteredPlaces.forEach(place => {
            const placeElement = document.createElement("div");
            placeElement.className = "place";
            placeElement.innerHTML = `
                <img src="${place.image}" alt="${place.name}">
                <div class="place-info">
                    <h3>${place.name}</h3>
                    <p>${place.description}</p>
                </div>`;
            placeElement.onclick = () => {
                map.setView([place.lat, place.lng], 16, { animate: true });
                setTimeout(() => {
                    markers.find(m => m.placeName === place.name).openPopup();
                }, 300);
            };
            if (bounds.contains([place.lat, place.lng])) {
                visibleList.appendChild(placeElement);
            } else {
                outsideList.appendChild(placeElement);
            }
        });
    }

    fetch('places.json')
        .then(response => response.json())
        .then(data => {
            placesData = data;
            updateMap();
        })
        .catch(error => console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:', error));

    map.on('moveend', () => updateSidebar(placesData.filter(place => {
        if (activeFilters.length === 0) return true;
        return place.attributes.some(attr => activeFilters.includes(attr));
    })));
</script>

</body>
</html>
